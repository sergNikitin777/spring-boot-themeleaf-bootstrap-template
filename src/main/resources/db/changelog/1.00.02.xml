<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet id="1.00.02-1" author="vyudintsev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM ADMUSER WHERE EMAIL IN ('user1@test.com')
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO ADMUSER (EMAIL,USERNAME,USERPASSWORD)
            VALUES ('user1@test.com', 'user1', '24c9e15e52afc47c225b757e7bee1f9d');  <!-- md5 encode -->
        </sql>
    </changeSet>

    <changeSet id="1.00.02-2" author="vyudintsev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM ADMROLE WHERE ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO ADMROLE (ROLENAME,ROLECODE)
            VALUES ('Администратор (руководитель технической службы ИОГВ)',
                'АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)');
        </sql>
    </changeSet>


    <changeSet id="1.00.02-3" author="vyudintsev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) 
                FROM ADMUSER user
                JOIN ADMROLE role ON role.ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
                WHERE user.EMAIL IN ('user1@test.com')
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO ADMUSERROLE (users_ADMUSERID, roles_ADMROLEID)
            SELECT user.ID, role.ID
            FROM ADMUSER user
            JOIN ADMROLE role ON role.ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
            WHERE user.EMAIL IN ('user1@test.com')
        </sql>
    </changeSet>

    <changeSet id="1.00.02-4" author="vyudintsev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM AUTHORITY WHERE AUTHORITYCODE IN ('УПРАВЛЕНИЕПОЛЬЗОВАТЕЛЯМИ_ПОЛЬЗОВАТЕЛИ_ДОБАВИТЬ')
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO AUTHORITY (AUTHORITYCODE)
            VALUES ('УПРАВЛЕНИЕПОЛЬЗОВАТЕЛЯМИ_ПОЛЬЗОВАТЕЛИ_ДОБАВИТЬ');
        </sql>
    </changeSet>

    <changeSet id="1.00.02-5" author="vyudintsev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) 
                FROM ADMROLE role
                JOIN AUTHORITY auth ON auth.AUTHORITYCODE IN ('УПРАВЛЕНИЕПОЛЬЗОВАТЕЛЯМИ_ПОЛЬЗОВАТЕЛИ_ДОБАВИТЬ')
                WHERE role.ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO ADMUSERROLE (roles_ADMROLEID, authorities_AUTHORITYID)
            SELECT role.ID, auth.ID
            FROM ADMROLE role
            JOIN AUTHORITY auth ON auth.AUTHORITYCODE IN ('УПРАВЛЕНИЕПОЛЬЗОВАТЕЛЯМИ_ПОЛЬЗОВАТЕЛИ_ДОБАВИТЬ')
            WHERE role.ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
        </sql>
    </changeSet>
    
    
</databaseChangeLog>
