<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet id="1.00.02-1" author="vyudintsev">
<!--         <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM ADMUSER WHERE EMAIL IN ('user1@test.com')
            </sqlCheck>
        </preConditions> -->
        <sql>
            INSERT INTO ADMUSER (EMAIL,USERNAME,USERPASSWORD)
            VALUES ('user1@test.com', 'user1', '24c9e15e52afc47c225b757e7bee1f9d');  <!-- md5 encode -->
        </sql>
    </changeSet>

    <changeSet id="1.00.02-2" author="vyudintsev">
<!--         <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM ADMROLE WHERE ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
            </sqlCheck>
        </preConditions> -->
        <sql>
            INSERT INTO ADMROLE (ROLENAME,ROLECODE)
            VALUES ('Администратор (руководитель технической службы ИОГВ)',
                'АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)');
        </sql>
    </changeSet>


    <changeSet id="1.00.02-3" author="vyudintsev" dbms="postgresql">
<!--         <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) 
                FROM ADMUSER user
                JOIN ADMROLE role ON role.ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
                WHERE user.EMAIL IN ('user1@test.com')
            </sqlCheck>
        </preConditions> -->
        <sql>
            INSERT INTO ADMUSERROLE ("users_ADMUSERID", "roles_ADMROLEID")
            SELECT usr.ADMUSERID, role.ADMROLEID
            FROM ADMUSER usr
            JOIN ADMROLE role ON role.ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
            WHERE usr.EMAIL IN ('user1@test.com')
        </sql>
    </changeSet>
    
    <changeSet id="1.00.02-3" author="vyudintsev" dbms="h2">
<!--         <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) 
                FROM ADMUSER user
                JOIN ADMROLE role ON role.ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
                WHERE user.EMAIL IN ('user1@test.com')
            </sqlCheck>
        </preConditions> -->
        <sql>
            INSERT INTO ADMUSERROLE (users_ADMUSERID, roles_ADMROLEID)
            SELECT usr.ADMUSERID, role.ADMROLEID
            FROM ADMUSER usr
            JOIN ADMROLE role ON role.ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
            WHERE usr.EMAIL IN ('user1@test.com')
        </sql>
    </changeSet>

    <changeSet id="1.00.02-4" author="vyudintsev">
<!--         <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM AUTHORITY WHERE AUTHORITYCODE IN ('ROLE_R_управлениепользователями_пользователи_добавить')
            </sqlCheck>
        </preConditions> -->
        <sql>
            INSERT INTO AUTHORITY (AUTHORITYCODE, AUTHORITYNAME)
            VALUES ('ROLE_R_управлениепользователями_пользователи_добавить', 'управлениепользователями_пользователи_добавить');
        </sql>
    </changeSet>

    <changeSet id="1.00.02-5" author="vyudintsev"  dbms="postgresql">
        <!-- <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) 
                FROM ADMROLE_AUTHORITY adm_auth
                JOIN AUTHORITY auth ON auth.AUTHORITYCODE IN ('ROLE_R_управлениепользователями_пользователи_добавить')
                WHERE adm_auth.
            </sqlCheck>
        </preConditions> -->
        <sql>
            INSERT INTO ADMROLE_AUTHORITY ("roles_ADMROLEID", "authorities_AUTHORITYID")
            SELECT role.ADMROLEID, ath.AUTHORITYID
            FROM ADMROLE role
            JOIN AUTHORITY ath ON ath.AUTHORITYCODE IN ('ROLE_R_управлениепользователями_пользователи_добавить')
            WHERE role.ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
        </sql>
    </changeSet>
    
    <changeSet id="1.00.02-5" author="vyudintsev" dbms="h2">
        <!-- <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) 
                FROM ADMROLE_AUTHORITY adm_auth
                JOIN AUTHORITY auth ON auth.AUTHORITYCODE IN ('ROLE_R_управлениепользователями_пользователи_добавить')
                WHERE adm_auth.
            </sqlCheck>
        </preConditions> -->
        <sql>
            INSERT INTO ADMROLE_AUTHORITY (roles_ADMROLEID, authorities_AUTHORITYID)
            SELECT role.ADMROLEID, ath.AUTHORITYID
            FROM ADMROLE role
            JOIN AUTHORITY ath ON ath.AUTHORITYCODE IN ('ROLE_R_управлениепользователями_пользователи_добавить')
            WHERE role.ROLECODE IN ('АДМИНИСТРАТОР (РУКОВОДИТЕЛЬ ТЕХНИЧЕСКОЙ СЛУЖБЫ ИОГВ)')
        </sql>
    </changeSet>
    
    
</databaseChangeLog>
